<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <!-- /// META TIÊU ĐỀ & MÔ TẢ /// -->
    <title>Niyaki Pham | Profile Cá Nhân | Nhà Phát Triển & Sáng Tạo</title>
    <meta name="description" content="Chào mừng đến với profile cá nhân của Niyaki Phạm (Phạm Văn Hoàng) - Nơi hội tụ đam mê công nghệ, lập trình và sáng tạo. Khám phá các dự án, nghe playlist và liên hệ với Niyaki (Hoàng Nghiền PC).">
    <meta name="author" content="Niyaki Pham (Phạm Văn Hoàng)">

    <!-- /// META TỪ KHÓA SEO /// -->
    <meta name="keywords" content="Niyaki Phạm, Niyaki Pham, niyakipham, Nishima Hayashi, Hoàng Nghiền PC, Phạm Văn Hoàng, Pham Van Hoang, Phạm Văn Hoàng 2006, Phạm Văn Hoàng HP, Phạm Văn Hoàng Hải Phòng, Lập trình viên Hải Phòng, Developer Hải Phòng, Profile cá nhân, Porfolio, Web Developer, AI, Khoa học viễn tưởng, Sci-fi profile, Music Playlist, Audio Player, Real-time Clock">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">

    <!-- /// META CANONICAL URL /// -->
    <link rel="canonical" href="https://niyakipham.github.io/"> <!-- !! Quan trọng: Thay bằng URL chính thức của bạn !! -->

    <!-- /// META ICON (FAVICON) /// -->
    <link rel="icon" href="https://niyakipham.github.io/assets/kaguya.jpeg" type="image/jpeg">
    <link rel="apple-touch-icon" href="https://niyakipham.github.io/assets/kaguya.jpeg">

    <!-- /// META OPEN GRAPH /// -->
    <meta property="og:title" content="Niyaki Phạm (Phạm Văn Hoàng) - Profile Sci-Fi với Playlist">
    <meta property="og:description" content="Khám phá thế giới sáng tạo của Niyaki Phạm qua profile độc đáo, tích hợp playlist nhạc, đồng hồ. Liên hệ ngay!">
    <meta property="og:type" content="profile">
    <meta property="og:url" content="https://niyakipham.github.io/"> <!-- !! Quan trọng: Thay bằng URL chính thức của bạn !! -->
    <meta property="og:image" content="https://raw.githubusercontent.com/niyakipham/assets/kaguya.jpeg">
    <meta property="og:image:alt" content="Ảnh đại diện của Niyaki Phạm">
    <meta property="og:locale" content="vi_VN">
    <meta property="profile:username" content="niyakipham">

    <!-- /// META TWITTER CARD /// -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Niyaki Phạm - Profile Cá Nhân Độc Đáo">
    <meta name="twitter:description" content="Kết nối với Niyaki Phạm (Phạm Văn Hoàng / Hoàng Nghiền PC) - Nhà phát triển trẻ đầy đam mê từ Hải Phòng.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/niyakipham/assets/kaguya.jpeg">
    <meta name="twitter:site" content="@niyakipham"> <!-- Thay nếu có -->
    <meta name="twitter:creator" content="@niyakipham"> <!-- Thay nếu có -->

    <!-- /// GOOGLE FONTS /// -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <!-- /// IONICONS /// -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js" defer></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js" defer></script>

    <!-- /// ANIME.JS /// -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <style>
        /* === CSS RESET & BASE STYLES === */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            /* Colors & Config */
            --color-bg-dark: #0a0a0a; --color-primary: #e11d48; --color-secondary: #f43f5e;
            --color-accent: #f87171; --color-text-primary: #f1f1f1; --color-text-secondary: #a1a1a1;
            --color-primary-rgb: 225, 29, 72; --color-glitch-1: #00ffff; --color-glitch-2: #ff00ff;
            /* Fonts */
            --font-primary: 'Inter', sans-serif; --font-secondary: 'Orbitron', sans-serif;
            /* Grid BG */
            --grid-size: 30px; --grid-line-color: rgba(var(--color-primary-rgb), 0.08); --grid-line-width: 1px;
            /* Animation & Transition */
            --transition-speed-fast: 0.2s; --transition-speed-normal: 0.4s;
            /* Border Radius */
            --border-radius-sm: 4px; --border-radius-md: 8px; --border-radius-lg: 16px; --border-radius-circle: 50%;
            /* Spacing */
            --space-xs: 0.5rem; --space-sm: 1rem; --space-md: 1.5rem; --space-lg: 2.5rem;
        }
        html { font-size: 16px; scroll-behavior: smooth; }
        body {
            font-family: var(--font-primary); color: var(--color-text-primary); background-color: var(--color-bg-dark);
            background-image: linear-gradient(to right, var(--grid-line-color) var(--grid-line-width), transparent var(--grid-line-width)), linear-gradient(to bottom, var(--grid-line-color) var(--grid-line-width), transparent var(--grid-line-width));
            background-size: var(--grid-size) var(--grid-size);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: var(--space-sm);
            overflow-x: hidden; position: relative; line-height: 1.6;
        }
        body::before { /* Scanline Overlay */ content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4" viewBox="0 0 4 4"><path fill="%23cccccc" fill-opacity="0.02" d="M0 0h2v2H0zM2 2h2v2H0z"></path></svg>'); opacity: 0.6; pointer-events: none; z-index: -1; animation: scanlines 15s linear infinite; }
        @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 150px; } }

        /* === MAIN CONTAINER === */
        #container {
            background-color: rgba(16, 16, 16, 0.7); backdrop-filter: blur(12px) saturate(180%); -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--border-radius-lg);
            padding: var(--space-lg) var(--space-md); max-width: 480px; width: 100%;
            text-align: center; box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(var(--color-primary-rgb), 0.15);
            position: relative; overflow: hidden; transform-style: preserve-3d;
            opacity: 0; transform: translateY(20px); /* JS */
            display: flex; flex-direction: column;
        }

        /* === PROFILE SECTION === */
        #profile { margin-bottom: var(--space-sm); position: relative; display: flex; flex-direction: column; align-items: center; }
        #profile-image-wrapper { position: relative; width: 110px; height: 110px; margin-bottom: var(--space-sm); }
        #profile-image-wrapper::before { /* Avatar Glow */ content: ''; position: absolute; inset: -5px; border-radius: var(--border-radius-circle); background: conic-gradient(from 90deg, transparent 0%, var(--color-secondary) 25%, var(--color-primary) 50%, var(--color-secondary) 75%, transparent 100%); filter: blur(15px); z-index: -1; animation: rotateGlow 5s linear infinite; opacity: 0.7; }
        @keyframes rotateGlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #profile img#avatar { width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius-circle); border: 3px solid var(--color-primary); padding: 3px; background-color: var(--color-bg-dark); transition: transform var(--transition-speed-normal) ease, box-shadow var(--transition-speed-normal) ease; cursor: pointer; position: relative; z-index: 1; }
        #profile img#avatar:hover { transform: scale(1.05) rotate(2deg); box-shadow: 0 0 20px var(--color-primary); }
        #profile p#username { font-weight: 500; font-size: 1.1rem; color: var(--color-text-primary); margin-top: var(--space-xs); font-family: var(--font-secondary); letter-spacing: 1px; text-shadow: 0 0 5px var(--color-secondary), 1px 1px 1px rgba(0,0,0,0.5); margin-bottom: var(--space-xs); }
        .glitch-text { position: relative; text-shadow: 0.05em 0 0 var(--color-glitch-1), -0.025em -0.05em 0 var(--color-glitch-2), 0.025em 0.05em 0 var(--color-glitch-1); animation: glitchAnim 0.5s infinite alternate; }
        @keyframes glitchAnim { /* Keyframes */ 0%{text-shadow:.05em 0 0 var(--color-glitch-1),-.05em -.025em 0 var(--color-glitch-2),-.025em .05em 0 var(--color-glitch-1)}25%{-0.05em -0.025em 0 var(--color-glitch-1),.025em .025em 0 var(--color-glitch-2),-0.05em -0.05em 0 var(--color-glitch-1)}50%{text-shadow:.025em .05em 0 var(--color-glitch-1),.05em 0 0 var(--color-glitch-2),0 -.05em 0 var(--color-glitch-1)}75%{text-shadow:-.05em 0 0 var(--color-glitch-1),-.025em -.025em 0 var(--color-glitch-2),-.025em -.05em 0 var(--color-glitch-1)}100%{text-shadow:-.025em 0 0 var(--color-glitch-1),.025em -.025em 0 var(--color-glitch-2),.05em .05em 0 var(--color-glitch-1)} }

        /* === CLOCK STYLES === */
        #clock { font-family: var(--font-secondary); font-size: 0.9rem; color: var(--color-text-secondary); letter-spacing: 2px; margin-bottom: var(--space-md); opacity: 0; transform: translateY(10px); /* JS */ text-shadow: 0 0 3px rgba(var(--color-primary-rgb), 0.3); }

        /* === AUDIO PLAYER (Playlist Version) === */
        #audio-player { background-color: rgba(var(--color-primary-rgb), 0.05); border: 1px solid rgba(var(--color-primary-rgb), 0.2); border-radius: var(--border-radius-md); padding: var(--space-sm); margin: 0 0 var(--space-md) 0; opacity: 0; transform: translateY(10px); /* JS */ box-shadow: inset 0 1px 5px rgba(var(--color-primary-rgb), 0.1); display: flex; flex-direction: column; gap: var(--space-sm); }
        #audio-player .track-info { width: 100%; text-align: left; overflow: hidden; display: flex; flex-direction: column; gap: var(--space-xs); }
        #audio-player #track-title { display: block; font-size: 0.9rem; color: var(--color-text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-family: var(--font-secondary); letter-spacing: 0.5px; padding: 0 var(--space-xs); }
        #audio-player .progress-container { width: 100%; height: 8px; background-color: rgba(0, 0, 0, 0.3); border-radius: var(--border-radius-sm); cursor: pointer; overflow: hidden; position: relative; border: 1px solid rgba(var(--color-primary-rgb), 0.1); }
        #audio-player #progress-bar { width: 0%; height: 100%; background-color: var(--color-primary); border-radius: var(--border-radius-sm); transition: width 0.1s linear; box-shadow: 0 0 8px 1px var(--color-primary); }
        #audio-player .controls { width: 100%; display: flex; justify-content: space-between; align-items: center; gap: var(--space-sm); padding: 0 var(--space-xs); }
        #audio-player .controls .main-controls { display: flex; align-items: center; gap: var(--space-md); }
        #audio-player .controls .extra-controls { display: flex; align-items: center; gap: var(--space-sm); }
        #audio-player .controls button { background: none; border: none; color: var(--color-text-secondary); font-size: 1.6rem; cursor: pointer; padding: var(--space-xs); display: flex; align-items: center; justify-content: center; transition: color var(--transition-speed-fast) ease, transform var(--transition-speed-fast) ease, background-color var(--transition-speed-fast) ease; line-height: 1; border-radius: var(--border-radius-circle); }
        #audio-player .controls button:hover, #audio-player .controls button:focus { color: var(--color-secondary); transform: scale(1.1); outline: none; background-color: rgba(var(--color-primary-rgb), 0.1); }
        #audio-player .controls button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; background-color: transparent; }
        #audio-player .controls button ion-icon { display: block; }
        #audio-player button#play-pause-btn { font-size: 2.4rem; color: var(--color-secondary); }
        #audio-player button#play-pause-btn:hover, #audio-player button#play-pause-btn:focus { color: var(--color-primary); background-color: rgba(var(--color-primary-rgb), 0.15); }
        #audio-player .controls button.active { color: var(--color-primary); /* box-shadow: 0 0 8px rgba(var(--color-primary-rgb), 0.5); */ background-color: rgba(var(--color-primary-rgb), 0.1); }

        /* === LINKS LIST === */
        #links ul { list-style: none; padding: 0; margin: 0 0 var(--space-md) 0; display: flex; flex-direction: column; gap: var(--space-sm); }
        #links li { opacity: 0; transform: translateX(-20px); /* JS */ }
        #links a { display: block; padding: var(--space-sm) var(--space-md); text-decoration: none; color: var(--color-text-primary); background-color: rgba(var(--color-primary-rgb), 0.1); border: 1px solid rgba(var(--color-primary-rgb), 0.5); border-radius: var(--border-radius-sm); font-weight: 500; transition: all var(--transition-speed-fast) ease-out; position: relative; overflow: hidden; z-index: 1; will-change: transform, background-color, box-shadow; }
        #links a::before { /* Scanline Hover */ content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(var(--color-primary-rgb), 0.4), transparent); transition: left var(--transition-speed-normal) ease-out; z-index: -1; }
        #links a:hover, #links a:focus { background-color: rgba(var(--color-primary-rgb), 0.25); border-color: var(--color-primary); color: #fff; transform: scale(1.03); box-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.4); outline: none; }
        #links a:hover::before, #links a:focus::before { left: 100%; }
        #links a:active { transform: scale(0.98); background-color: rgba(var(--color-primary-rgb), 0.3); }

        /* === SOCIAL LINKS === */
        #social-links { display: flex; justify-content: center; gap: var(--space-md); margin-top: 0; padding: var(--space-md) 0; border-top: 1px solid rgba(255, 255, 255, 0.1); opacity: 0; transform: translateY(20px); /* JS */ }
        #social-links a { display: inline-flex; align-items: center; justify-content: center; color: var(--color-text-secondary); font-size: 1.7rem; width: 42px; height: 42px; border-radius: var(--border-radius-circle); text-decoration: none; transition: all var(--transition-speed-fast) ease; will-change: transform, color, background-color; }
        #social-links a:hover, #social-links a:focus { color: var(--color-primary); transform: translateY(-3px) scale(1.1); outline: none; background-color: rgba(var(--color-primary-rgb), 0.1); }
        #social-links ion-icon { display: block; }

        /* === FOOTER === */
        footer { margin-top: var(--space-md); font-size: 0.85rem; color: var(--color-text-secondary); opacity: 0; transform: translateY(20px); /* JS */ }
        footer a { color: var(--color-accent); text-decoration: none; font-weight: 500; transition: color var(--transition-speed-fast) ease, text-shadow var(--transition-speed-fast) ease; }
        footer a:hover, footer a:focus { color: var(--color-secondary); text-shadow: 0 0 5px var(--color-secondary); outline: none; }

        /* === RESPONSIVENESS === */
        @media (max-width: 768px) { :root { --space-lg: 2rem; } #container { padding: var(--space-md) var(--space-sm); margin: var(--space-sm); } #profile-image-wrapper { width: 100px; height: 100px; } #clock {font-size: 0.8rem;} #audio-player{ padding: var(--space-xs); } #audio-player .controls {gap: var(--space-xs); padding: 0;} #audio-player .controls .main-controls {gap: var(--space-sm);} #audio-player .controls .extra-controls {gap: var(--space-xs);} #audio-player .controls button {font-size: 1.5rem;} #audio-player button#play-pause-btn {font-size: 2.2rem;} #social-links { gap: var(--space-sm); } #social-links a { font-size: 1.6rem; width: 40px; height: 40px; } }
        @media (max-width: 420px) { #clock {letter-spacing: 1px;} #audio-player #track-title {font-size: 0.8rem;} #audio-player .controls .main-controls {gap: var(--space-xs);} #audio-player .controls button {font-size: 1.4rem; padding: var(--space-xs) / 2;} #audio-player button#play-pause-btn {font-size: 2rem;} #social-links { gap: var(--space-xs); } #social-links a { font-size: 1.5rem; width: 36px; height: 36px; } #links a { padding: var(--space-sm); } }

        /* === UTILITY CLASSES === */
        .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }

    </style>
</head>
<body>

    <div id="container">
        <div id="profile">
            <div id="profile-image-wrapper">
                <img id="avatar" src="https://niyakipham.github.io/assets/kaguya.jpeg" alt="Ảnh đại diện anime của Niyaki Phạm"/>
            </div>
            <p id="username" data-text="@niyakipham">@niyakipham</p>
            <div id="clock">00:00:00</div>
        </div>

        <!-- /// AUDIO PLAYER (Playlist Version) /// -->
        <div id="audio-player">
            <div class="track-info">
                 <span id="track-title">Đang tải nhạc...</span>
                 <div class="progress-container">
                     <div id="progress-bar"></div>
                 </div>
            </div>
             <div class="controls">
                <div class="extra-controls">
                    <button id="shuffle-btn" aria-label="Trộn bài đang tắt">
                         <ion-icon name="shuffle-outline"></ion-icon>
                    </button>
                    <button id="repeat-btn" aria-label="Không lặp lại">
                         <ion-icon name="repeat-outline"></ion-icon>
                    </button>
                </div>
                 <div class="main-controls">
                     <button id="prev-btn" aria-label="Bài trước" disabled> <!-- Disabled initially -->
                         <ion-icon name="play-skip-back-outline"></ion-icon>
                    </button>
                     <button id="play-pause-btn" aria-label="Phát nhạc" disabled> <!-- Disabled initially -->
                        <ion-icon name="play-outline"></ion-icon>
                    </button>
                     <button id="next-btn" aria-label="Bài tiếp theo" disabled> <!-- Disabled initially -->
                         <ion-icon name="play-skip-forward-outline"></ion-icon>
                    </button>
                </div>
             </div>
        </div>
        <!-- /// END AUDIO PLAYER /// -->

        <nav id="links" aria-label="Liên kết chính">
             <span id="main-content" class="visually-hidden">Nội dung chính</span>
            <ul>
                <li><a href="https://facebook.com/niyakipham" target="_blank" rel="noopener noreferrer">Facebook</a></li>
                <li><a href="https://zalo.me/0901574726" target="_blank" rel="noopener noreferrer">Zalo</a></li>
                <li><a href="https://github.com/niyakipham" target="_blank" rel="noopener noreferrer">Github</a></li>
                <li><a href="https://discordapp.com/users/niyakipham.off" target="_blank" rel="noopener noreferrer">Discord</a></li>
            </ul>
        </nav>

        <div id="social-links" aria-label="Liên kết mạng xã hội khác">
            <a href="https://github.com/niyakipham" target="_blank" rel="noopener noreferrer" aria-label="Niyaki Phạm trên Github" title="Github"><ion-icon name="logo-github"></ion-icon></a>
            <a href="https://instagram.com/niyakipham" target="_blank" rel="noopener noreferrer" aria-label="Niyaki Phạm trên Instagram" title="Instagram"><ion-icon name="logo-instagram"></ion-icon></a>
            <a href="https://youtube.com/niyakipham" target="_blank" rel="noopener noreferrer" aria-label="Niyaki Phạm trên Youtube" title="YouTube"><ion-icon name="logo-youtube"></ion-icon></a>
            <a href="https://linkedin.com/in/niyakipham" target="_blank" rel="noopener noreferrer" aria-label="Niyaki Phạm trên LinkedIn" title="LinkedIn"><ion-icon name="logo-linkedin"></ion-icon></a>
        </div>

        <footer>
             Website được tạo với ❤️ bởi <a href="https://github.com/niyakipham" target="_blank" rel="noopener noreferrer">Niyaki Pham (Phạm Văn Hoàng)</a>
        </footer>

    </div> <!-- End #container -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const introStaggerDelay = 80;
            const glitchEffectOnLoad = true;
            const glitchDuration = 1500;

            // --- PLAYLIST DATA ---
            const playlist = [
                {
                    url: 'https://a128-z3.zmdcdn.me/0d6ae249f9f42752b26229ee68df27bc?authen=exp=1744464878~acl=/0d6ae249f9f42752b26229ee68df27bc*~hmac=87943c9019f34f31c68bde4eb0ab0964',
                    // Title sẽ được trích xuất tự động từ URL
                },
                {
                    url: 'https://vnno-ne-1-tf-a128-z3.zmdcdn.me/523fb2bef2f3b3c8497c6efe228c737c?authen=exp=1744465057~acl=/523fb2bef2f3b3c8497c6efe228c737c*~hmac=6e54ab3c587edae4e8c4896b431ecad6',
                    // Title sẽ được trích xuất tự động từ URL
                }
                // { url: '...', title: '...' } // Thêm bài khác
            ];

            // --- GET DOM ELEMENTS ---
            const clockElement = document.getElementById('clock');
            const audioPlayer = document.getElementById('audio-player');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const shuffleBtn = document.getElementById('shuffle-btn');
            const repeatBtn = document.getElementById('repeat-btn');
            const playIcon = playPauseBtn?.querySelector('ion-icon'); // Use optional chaining
            const repeatIcon = repeatBtn?.querySelector('ion-icon');
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = audioPlayer?.querySelector('.progress-container');
            const trackTitleElement = document.getElementById('track-title');
            const usernameElement = document.getElementById('username');
            const avatar = document.getElementById('avatar');
            const mainLinks = document.querySelectorAll('#links a');
            const socialIcons = document.querySelectorAll('#social-links a ion-icon');

            // --- AUDIO PLAYER STATE ---
            let audio = null; // The HTMLAudioElement
            let currentTrackIndex = 0; // Index in the playlist array
            let isPlaying = false;
            let isShuffle = false;
            let repeatMode = 'none'; // 'none', 'all', 'one'
            let userHasInteracted = false; // To help with autoplay restrictions
            let originalPlaylistOrder = [...playlist]; // Store original order if shuffle is used (optional, could simplify)

            // --- HELPER: Set Primary Color RGB Variable ---
            function setPrimaryColorRGB() {
                if (typeof window === 'undefined' || !document?.documentElement) return;
                try {
                    const style = window.getComputedStyle(document.documentElement);
                    let color = style.getPropertyValue('--color-primary').trim();
                    let r = 225, g = 29, b = 72; // Default
                    // Basic hex/rgb parsing... (Same as before)
                    if (color.startsWith('#')) {/*...*/} else if (color.startsWith('rgb')) {/*...*/}
                    if (isNaN(r) || isNaN(g) || isNaN(b)) { [r, g, b] = [225, 29, 72]; }
                    document.documentElement.style.setProperty('--color-primary-rgb', `${r}, ${g}, ${b}`);
                } catch (e) { document.documentElement.style.setProperty('--color-primary-rgb', `225, 29, 72`); }
            }
            setPrimaryColorRGB();

            // --- REAL-TIME CLOCK ---
            let clockInterval = null;
            function updateClock() {
                if (!clockElement) return;
                try {
                    const now = new Date();
                    clockElement.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                } catch (e) { if(clockInterval) clearInterval(clockInterval); }
            }
            if (clockElement) { updateClock(); clockInterval = setInterval(updateClock, 1000); }

            // --- AUDIO PLAYER FUNCTIONS ---

            // Safely extract title from URL
             function getTrackTitle(track) {
                 if (track.title) return track.title; // Use predefined if available
                 try {
                    let decodedUrl = decodeURIComponent(track.url);
                    const filename = decodedUrl.substring(decodedUrl.lastIndexOf('/') + 1);
                     // Remove .mp3 extension (case-insensitive)
                    return filename.replace(/\.mp3$/i, '').replace(/[_+]/g, ' ').trim() || `Track ${currentTrackIndex + 1}`;
                 } catch (e) {
                    console.warn("Error parsing title from URL:", track.url, e);
                     return `Track ${currentTrackIndex + 1}`; // Fallback title
                 }
             }

            // Load a track into the audio element
            function loadTrack(index) {
                 if (typeof Audio === 'undefined') { console.error("Audio API not supported"); return; }
                 if (!playlist || index < 0 || index >= playlist.length) { console.error("Invalid track index:", index); return; }

                 if (!audio) { // Create and configure the audio element ONCE
                     try {
                         audio = new Audio();
                         audio.preload = 'metadata'; // Important for getting duration
                         // audio.crossOrigin = "anonymous"; // Usually NOT needed for GitHub raw, can cause issues if headers aren't right
                         addAudioListeners();
                         console.log("Audio element created.");
                    } catch (e) {
                         console.error("Cannot create Audio object:", e);
                         if(trackTitleElement) trackTitleElement.textContent = "Lỗi Player";
                         disableAllControls(); // Disable if creation failed
                         return; // Stop further processing
                     }
                 }

                const track = playlist[index];
                currentTrackIndex = index;
                console.log(`Attempting to load: Index ${index}, URL: ${track.url}`);
                audio.src = track.url; // Set the source
                if(trackTitleElement) trackTitleElement.textContent = getTrackTitle(track); // Update title

                // Reset UI for new track
                 if (progressBar) progressBar.style.width = '0%';
                updatePlayPauseButton(false); // Show play icon initially
                 audio.load(); // Tell the browser to load the new source

                // Enable/Disable Prev/Next based on mode and position (consider shuffle later)
                 if (prevBtn) prevBtn.disabled = (repeatMode !== 'one' && currentTrackIndex === 0 && !isShuffle && repeatMode !=='all'); // Basic non-shuffle logic
                if (nextBtn) nextBtn.disabled = (repeatMode !== 'one' && currentTrackIndex === playlist.length - 1 && !isShuffle && repeatMode !=='all'); // Basic non-shuffle logic

                console.log(`Loaded metadata for track ${index}`);
             }

            // Add necessary event listeners to the audio element
            function addAudioListeners() {
                if (!audio) return;

                 // TIME UPDATE: Update progress bar
                audio.addEventListener('timeupdate', () => {
                    if (audio.duration && !isNaN(audio.duration) && progressBar) {
                         progressBar.style.width = `${(audio.currentTime / audio.duration) * 100}%`;
                     }
                });

                 // ENDED: Handle what happens when a track finishes
                audio.addEventListener('ended', () => {
                    console.log(`Track ${currentTrackIndex} ended. Repeat: ${repeatMode}, Shuffle: ${isShuffle}`);
                     isPlaying = false; // Set playing state to false before deciding next action
                     if (repeatMode === 'one') {
                        audio.currentTime = 0; // Reset time
                         playAudio(); // Replay current track immediately
                     } else {
                         playNextTrack(true); // Play next, this handles shuffle/repeat-all/end-of-list
                     }
                 });

                 // ERROR: Handle playback errors
                 audio.addEventListener('error', (e) => {
                    console.error("Audio Error Event:", e);
                    let errorMsg = "Lỗi không xác định";
                     if (audio.error) {
                         switch (audio.error.code) {
                            case MediaError.MEDIA_ERR_ABORTED: errorMsg = 'Bị hủy bởi người dùng'; break;
                             case MediaError.MEDIA_ERR_NETWORK: errorMsg = 'Lỗi mạng'; break;
                             case MediaError.MEDIA_ERR_DECODE: errorMsg = 'Lỗi giải mã'; break;
                            case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED: errorMsg = 'Định dạng không hỗ trợ'; break;
                            default: errorMsg = `Lỗi không rõ (${audio.error.code})`;
                        }
                         console.error(`Specific Audio Error: Code ${audio.error.code}, Message: ${audio.error.message || errorMsg}`);
                     }
                    if (trackTitleElement) trackTitleElement.textContent = errorMsg;
                     disableMainControls(); // Disable play/prev/next on critical error
                     updatePlayPauseButton(false); // Show play icon
                    isPlaying = false;
                });

                // CAN PLAY: Optionally log when ready
                audio.addEventListener('canplay', () => {
                    // Duration might be available now
                    console.log(`Track ${currentTrackIndex} ready. Duration: ${audio.duration}`);
                    // Re-enable buttons potentially disabled by load issues
                     if (!audio.error) enableMainControls();
                });

                // Optional: Handle stalled network etc.
                 // audio.addEventListener('stalled', () => { console.warn("Audio stalled..."); });
            }

            // Toggle play/pause state
            function togglePlayPause() {
                if (!audio || !audio.src || !playPauseBtn || playPauseBtn.disabled) return; // Need audio and button

                if (isPlaying) {
                    pauseAudio();
                 } else {
                    playAudio();
                }
            }

             // Explicit Play function handling promises
            function playAudio() {
                 if (!audio || !audio.src || playPauseBtn.disabled) return;
                console.log(`Attempting to play track ${currentTrackIndex}`);
                const playPromise = audio.play();

                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log(`Playback started for track ${currentTrackIndex}`);
                         isPlaying = true;
                        userHasInteracted = true;
                         updatePlayPauseButton(true);
                    }).catch(error => {
                        console.error("Audio play() promise rejected:", error);
                         isPlaying = false;
                         updatePlayPauseButton(false);
                         if (error.name === 'NotAllowedError' && trackTitleElement) {
                            trackTitleElement.textContent = 'Click để phát'; // Or a more informative message
                        } else if (trackTitleElement) {
                             trackTitleElement.textContent = `Lỗi Play: ${error.name}`;
                        }
                     });
                } else {
                     // Fallback for older browsers or situations where play() doesn't return a promise
                     // Be cautious here as synchronous play can be blocked.
                    try {
                         isPlaying = true;
                         userHasInteracted = true;
                         updatePlayPauseButton(true);
                         console.log("Playback likely started (no promise returned).")
                    } catch(syncError){
                        console.error("Synchronous audio play failed (likely blocked):", syncError);
                         isPlaying = false;
                         updatePlayPauseButton(false);
                    }
                }
             }

            // Explicit Pause function
            function pauseAudio() {
                if (!audio) return;
                 audio.pause();
                isPlaying = false;
                updatePlayPauseButton(false);
                console.log(`Paused track ${currentTrackIndex}`);
            }

            // Go to the next track
            function playNextTrack(triggeredByEnd = false) { // triggeredByEnd helps decide repeat logic
                if (playlist.length <= 1 && repeatMode !== 'one') return; // No next if only 1 track unless repeating it

                let nextIndex;
                 if (isShuffle) {
                    // Simple shuffle: pick random, avoid immediate repeat
                     if (playlist.length <= 1) nextIndex = 0;
                    else {
                         do { nextIndex = Math.floor(Math.random() * playlist.length); }
                        while (nextIndex === currentTrackIndex);
                    }
                 } else {
                     nextIndex = (currentTrackIndex + 1); // Potential index
                     if (nextIndex >= playlist.length) { // Reached end
                         if (repeatMode === 'all') {
                             nextIndex = 0; // Wrap around if repeating all
                         } else {
                             // End of playlist, not repeating all
                            console.log("End of playlist reached.");
                             pauseAudio();
                             loadTrack(0); // Load first track, don't auto-play unless triggeredByEnd=true somehow? safer not to.
                            return; // Stop here
                         }
                     }
                 }
                 console.log(`Playing next: Index ${nextIndex}, Shuffle: ${isShuffle}, Repeat: ${repeatMode}`);
                loadTrack(nextIndex);
                playAudio(); // Always play when moving next
             }

            // Go to the previous track
            function playPrevTrack() {
                if (playlist.length <= 1 && repeatMode !== 'one') return;

                 // If track is near beginning, restart it, otherwise go to actual previous
                 if (audio.currentTime > 3 && repeatMode !== 'one') {
                     audio.currentTime = 0;
                    playAudio(); // Restart current track
                     return;
                 }

                let prevIndex;
                 if (isShuffle) {
                     // Simple previous in shuffle: random different track
                    if (playlist.length <= 1) prevIndex = 0;
                     else {
                         do { prevIndex = Math.floor(Math.random() * playlist.length); }
                        while (prevIndex === currentTrackIndex);
                     }
                } else {
                     prevIndex = (currentTrackIndex - 1);
                     if (prevIndex < 0) { // Was at the beginning
                         if (repeatMode === 'all') {
                             prevIndex = playlist.length - 1; // Wrap to end if repeating all
                        } else {
                            audio.currentTime = 0; // Just restart track 0 if not repeating all
                             // Optionally disable prev button here again? loadTrack handles some basic cases
                             console.log("At start, not repeating all, restarting track 0");
                            return;
                         }
                     }
                 }
                 console.log(`Playing previous: Index ${prevIndex}, Shuffle: ${isShuffle}, Repeat: ${repeatMode}`);
                loadTrack(prevIndex);
                playAudio(); // Always play when moving previous
            }

            // Cycle through repeat modes
            function cycleRepeatMode() {
                if (!repeatBtn || !repeatIcon) return;
                 if (repeatMode === 'none') {
                    repeatMode = 'all';
                    repeatBtn.classList.add('active');
                    repeatBtn.setAttribute('aria-label', 'Lặp lại tất cả');
                    // Icon stays 'repeat-outline' for 'all'
                 } else if (repeatMode === 'all') {
                    repeatMode = 'one';
                    repeatBtn.classList.add('active'); // Stays active
                    repeatBtn.setAttribute('aria-label', 'Lặp lại một bài');
                     repeatIcon.setAttribute('name', 'repeat-outline'); // Use CSS to potentially add '1' or keep it simple
                    // Could change icon to something else for 'one' e.g., infinite, but 'repeat' is clearer.
                 } else { // repeatMode === 'one'
                    repeatMode = 'none';
                    repeatBtn.classList.remove('active');
                    repeatBtn.setAttribute('aria-label', 'Không lặp lại');
                    repeatIcon.setAttribute('name', 'repeat-outline');
                }
                 console.log("Repeat Mode:", repeatMode);
                 // Update next/prev button disabled state based on new mode
                 loadTrack(currentTrackIndex); // Reload to re-evaluate button states without changing src
            }

            // Toggle shuffle mode
            function toggleShuffle() {
                 if (!shuffleBtn) return;
                isShuffle = !isShuffle;
                shuffleBtn.classList.toggle('active', isShuffle);
                shuffleBtn.setAttribute('aria-label', isShuffle ? 'Trộn bài đang bật' : 'Trộn bài đang tắt');
                 console.log("Shuffle Mode:", isShuffle);
                // Note: Simple shuffle picks random on next. More complex might pre-shuffle array.
             }

            // Update play/pause button icon and aria-label
            function updatePlayPauseButton(isPlayingState) {
                 if (!playIcon || !playPauseBtn) return;
                playIcon.setAttribute('name', isPlayingState ? 'pause-outline' : 'play-outline');
                playPauseBtn.setAttribute('aria-label', isPlayingState ? 'Tạm dừng nhạc' : 'Phát nhạc');
            }

             // Enable/disable main playback controls
             function enableMainControls(){
                 [playPauseBtn, prevBtn, nextBtn].forEach(btn => {if(btn) btn.disabled = false;});
             }
             function disableMainControls(){
                 [playPauseBtn, prevBtn, nextBtn].forEach(btn => {if(btn) btn.disabled = true;});
             }
             function disableAllControls(){
                 [playPauseBtn, prevBtn, nextBtn, shuffleBtn, repeatBtn].forEach(btn => {if(btn) btn.disabled = true;});
                 if(progressContainer) progressContainer.style.cursor = 'default'; // Indicate seeking disabled
             }


             // --- ADD EVENT LISTENERS TO BUTTONS ---
            if (playPauseBtn) playPauseBtn.addEventListener('click', togglePlayPause);
            if (nextBtn) nextBtn.addEventListener('click', () => playNextTrack(false)); // Manual next, don't use 'true' here
            if (prevBtn) prevBtn.addEventListener('click', playPrevTrack);
            if (shuffleBtn) shuffleBtn.addEventListener('click', toggleShuffle);
            if (repeatBtn) repeatBtn.addEventListener('click', cycleRepeatMode);

            // --- PROGRESS BAR SEEKING ---
            if (progressContainer) {
                 progressContainer.addEventListener('click', (e) => {
                     if (!audio || !audio.duration || isNaN(audio.duration)) return;
                     if (playPauseBtn.disabled) return; // Don't seek if controls are disabled
                     try {
                         const rect = progressContainer.getBoundingClientRect();
                         // Calculate click position as a fraction (0 to 1)
                         const clickPositionRatio = (e.clientX - rect.left) / progressContainer.offsetWidth;
                         // Clamp value between 0 and 1 to prevent weird seeks
                         const clampedRatio = Math.max(0, Math.min(1, clickPositionRatio));
                         audio.currentTime = clampedRatio * audio.duration;
                         console.log(`Seeked to: ${audio.currentTime.toFixed(2)}s`);
                         // No need to update progress bar manually here, timeupdate will handle it.
                    } catch (seekError) { console.error("Error seeking audio:", seekError); }
                });
            }

            // --- INITIALIZE FIRST TRACK and UI ---
            if (playlist && playlist.length > 0) {
                 loadTrack(0); // Load first track, initially disables buttons via loadTrack logic
                 // Buttons are re-enabled by 'canplay' event or disabled by 'error'
            } else {
                if(trackTitleElement) trackTitleElement.textContent = "Playlist trống";
                 disableAllControls(); // Disable all controls if playlist is empty
            }

            // --- ANIME.JS ANIMATION TIMELINE ---
            const tl = anime.timeline({ easing: 'easeOutExpo', duration: 800 });
             // Fade in elements sequence... (Same as before)
            tl.add({ targets: '#container', opacity: [0, 1], translateY: [20, 0], duration: 600 });
            tl.add({ targets: ['#profile-image-wrapper', '#profile p#username'], opacity: [0, 1], scale: [0.8, 1], duration: 700 }, '-=400');
            tl.add({ targets: '#clock', opacity: [0, 1], translateY: [10, 0], duration: 400 }, '-=500');
            tl.add({ targets: '#audio-player', opacity: [0, 1], translateY: [10, 0], duration: 500, easing: 'easeOutSine' }, '-=450');
            tl.add({ targets: '#links li', opacity: [0, 1], translateX: [-20, 0], delay: anime.stagger(introStaggerDelay) }, '-=500');
            tl.add({ targets: ['#social-links', 'footer'], opacity: [0, 1], translateY: [20, 0], duration: 500, easing: 'easeOutSine' }, '-=600');


            // --- USERNAME GLITCH EFFECT ---
            if (glitchEffectOnLoad && usernameElement) {
                 tl.add({ targets: usernameElement, duration: 100, complete: () => {
                     usernameElement.classList.add('glitch-text');
                     anime({ targets: usernameElement, opacity: [1, 0.8, 1, 0.9, 1], duration: glitchDuration, easing: 'steps(4)', complete: () => { usernameElement.classList.remove('glitch-text'); } });
                 } }, '-=200');
             }

             // --- INTERACTIVE HOVER ANIMATIONS ---
            if (avatar) { /* ... Avatar Hover ... */ }
             mainLinks.forEach(link => { /* ... Link Hover ... */ });
            socialIcons.forEach(icon => { /* ... Social Icon Hover ... */ });

            console.log("Niyaki Pham's Sci-Fi Profile Initialized! ✨ v7.1 (Playlist Refined)");
            console.log("Anime.js version:", anime.version);

        }); // End DOMContentLoaded
    </script>

</body>
</html>
